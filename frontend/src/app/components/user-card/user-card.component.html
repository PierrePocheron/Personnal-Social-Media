<ng-container *ngIf="user() as u; else loading">
    <div class="user-card rounded-2xl shadow-xl bg-white/80 backdrop-blur-sm p-6 w-full max-w-md transition hover:scale-[1.01] duration-300">
        <div class="flex items-center gap-4">
            <div class="flex items-center justify-center w-16 h-16 text-2xl font-semibold text-white rounded-full shadow-md avatar bg-gradient-to-tr from-blue-500 to-indigo-500">
                {{ initials }}
            </div>
            <div>
                <h2 class="text-xl font-bold text-gray-800">
                    {{ u.firstName }} {{ u.lastName }}
                </h2>
                <p class="text-sm text-gray-500">{{ u.nickname }}</p>
            </div>
        </div>

        <div class="relative">
            <button (click)="toggleDropdown()" class="ml-auto text-gray-500 transition hover:text-gray-800">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <div *ngIf="dropdownOpen()" class="absolute right-0 z-50 w-64 p-2 mt-2 overflow-y-auto bg-white rounded-lg shadow-xl ring-1 ring-black/10 max-h-80 animate-fade-in">
                <input [(ngModel)]="search" type="text" placeholder="Rechercher..." class="w-full p-2 mb-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />

                <button *ngFor="let p of filteredPersons()" (click)="selectPerson(p.id!)" class="block w-full text-left px-3 py-1.5 rounded hover:bg-indigo-100 transition">
                {{ p.firstName }} {{ p.lastName }} <span class="text-gray-400" *ngIf="p.nickname">({{ p.nickname }})</span>
              </button>
            </div>
        </div>


        <div class="mt-4 space-y-1 text-sm text-gray-600">
            <p><strong>Job :</strong> {{ u.job }} chez {{ u.company }}</p>
            <p><strong>Email :</strong> {{ u.email }}</p>
            <p><strong>Téléphone :</strong> {{ u.phoneNumber }}</p>
        </div>
    </div>
</ng-container>

<ng-template #loading>
    <div class="bg-white shadow-xl rounded-2xl h-52 animate-pulse"></div>
</ng-template>